<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">
<!--<![endif]-->
<!-- Begin Head -->

<head>
    <title>图书管理系统</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="MobileOptimized" content="320">
    <!--Start Style -->
    <link rel="stylesheet" type="text/css" href="static/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/icofont.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/style.css">
	<link rel="stylesheet" id="theme-change" type="text/css" href="">
</head>

<body>
	<div class="loader">
	  <div class="spinner">
		<img src="static/picture/loader.gif" alt="">
	  </div> 
	</div>
    <!-- Main Body -->
    <div class="page-wrapper">

        <div th:replace="header.html::title"></div>

        <!-- Sidebar Start -->
        <aside class="sidebar-wrapper">
            <div class="side-menu-wrap">
                <ul class="main-menu">
                    <li>
                        <a href="index" >
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            </span>
                            <span class="menu-text">
                                会议室信息
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="reserve-room" class="active">
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-package"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                            </span>
                            <span class="menu-text">
                                会议室预约
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="reservationLogs">
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                            </span>
                            <span class="menu-text">
                                预约记录
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>
        <!-- Container Start -->
        <div class="page-wrapper">
            <div class="main-content">
                <!-- Page Title Start -->
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <div class="page-title-wrapper">
                            <div class="page-title-box">
                                <h4 class="page-title">添加预约信息</h4>
                            </div>
                            <div class="breadcrumb-list">
                                <ul>
                                    <li class="breadcrumb-link">
                                        <a href="javascript:void(0);"><i class="fas fa-home mr-2"></i>会议室预约系统</a>
                                    </li>
                                    <li class="breadcrumb-link active">添加预约信息</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- From Start -->
                <div class="from-wrapper">
                    <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>添加预约</h4>
                                    <p class="card-desc">请在下方选择所要预约的 <code>会议室名称</code> 以及对应的 <code>预约时间段</code></p>
                                </div>
                                <div class="card-body">
                                    <form class="separate-form" id="search-form">
                                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                            <hr class="mt-4 mb-4">
                                            <h5 class="from-title mb-1">信息选择</h5>
<!--                                            <div class="row">-->
<!--                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">-->
<!--                                                    <div class="form-group">-->
<!--                                                        <label for="region" class="col-form-label">会议室</label>-->
<!--                                                        <select class="select2 form-control" id="region" name="room">-->
<!--                                                            <option th:value="${room.getRid()}" th:each="room : ${available_room_list}" th:text="${room.getRoom_name()}"></option>-->
<!--                                                        </select>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
                                            <!-- 添加参会人数输入框 -->
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group">
                                                        <label for="participants" class="col-form-label">参会人数</label>
                                                        <input type="number" class="form-control" id="participants" name="participants" min="1" placeholder="请输入参会人数">
                                                    </div>
                                                </div>
                                            </div>
                                            <!--  预约原因-->
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group">
                                                        <label for="apply_reason" class="col-form-label">申请原因</label>
                                                        <input type="text" class="form-control" id="apply_reason" name="apply_reason" placeholder="请输入申请原因">
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 添加预约日期输入框 -->
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group">
                                                        <label for="reservation-date" class="col-form-label">预约日期</label>
                                                        <input type="date" class="form-control" id="reservation-date" name="reservation-date">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group">
                                                        <label for="start-hour" class="col-form-label">开始时间</label>
                                                        <select class="form-control" id="start-hour" name="start-hour">
                                                            <!-- 生成从 0 到 23 的选项 -->
                                                            <script>                    for (let i = 8; i < 23; i++) {

                                                                const hour = i.toString().padStart(2, '0');
                                                                document.write(`<option value="${hour}">${hour}:00</option>`);
                                                            }
                                                            </script>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group">
                                                        <label for="end-hour" class="col-form-label">结束时间</label>
                                                        <select class="form-control" id="end-hour" name="end-hour">
                                                            <!-- 生成从 0 到 23 的选项 -->
                                                            <script>                    for (let i = 8; i < 23; i++) {

                                                                const hour = i.toString().padStart(2, '0');
                                                                document.write(`<option value="${hour}">${hour}:00</option>`);
                                                            }
                                                            </script>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group mb-0">
                                                <button class="btn btn-primary" type="submit">提交</button>
                                            </div>

                                        </div>
                                    </form>
                                    <div id="room-list" class="mt-4">
                                    <!-- 可预约的会议室列表将在这里显示 -->
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>

                </div>
                <div class="ad-footer-btm">
                    <p>Copyright © 2021.Company name All rights reserved.<a target="_blank" href="https://sc.chinaz.com/moban/">网页模板</a></p>
                </div>
            </div>
        </div>
    </div>
	
    <!-- Script Start -->
	<script src="static/js/jquery.min.js"></script>
    <script src="static/js/popper.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
	<script src="static/js/swiper.min.js"></script>
    <script src="static/js/apexcharts.min.js"></script>
    <script src="static/js/control-chart-apexcharts.js"></script>
	<!-- Page Specific -->
    <script src="static/js/nice-select.min.js"></script>
    <!-- Custom Script -->
    <script src="static/js/custom.js"></script>
    <script>
        function reserveRoom(roomId) {
            // 这里可以添加预约会议室的逻辑
            $.ajax({
                url: 'add-reservation',
                method: 'POST',
                data: {
                    rid: roomId,
                    participants: $('#participants').val(),
                    reservationDate: $('#reservation-date').val(),
                    startHour: $('#start-hour').val(),
                    endHour: $('#end-hour').val(),
                    applyReason: $('#apply_reason').val()
                },
                success: function (response) {
                    if(response.status === "success") {
                        window.location.href = 'reserve-room';
                        alert(response.message)
                    }else{
                        window.location.href = 'reserve-room';
                        alert(response.message)
                    }
                },
                error: function (xhr, status, error) {
                    window.location.href = 'reserve-room';
                    alert('会议室预约失败，请重试。');
                    console.error('Error reserving room:', error);
                }
            });
        }
    </script>
    <script>        $(document).ready(function () {
        $('#search-form').on('submit', function (e) {
            e.preventDefault();
            const participants = $('#participants').val();
            const reservationDate = $('#reservation-date').val();
            const startHour = $('#start-hour').val();
            const endHour = $('#end-hour').val();

            if (!participants || !reservationDate || !startHour || !endHour) {
                alert('请填写所有必填项！');
                return;
            }

            if (parseInt(endHour) <= parseInt(startHour)) {
                alert('结束时间必须晚于开始时间！');
                return;
            }

            $.ajax({
                url: 'search-rooms',
                method: 'POST',
                data: {
                    participants: participants,
                    reservationDate: reservationDate,
                    startHour: startHour,
                    endHour: endHour
                },
                success: function (response) {
                    const roomList = $('#room-list');
                    roomList.empty();
                    response.forEach(room => {
                        roomList.append(`                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h5 class="card-title">${room.room_name}</h5>
                                        <p class="card-text">容量: ${room.description}</p>
                                        <button class="btn btn-success" onclick="reserveRoom(${room.rid})">预约</button>
                                    </div>
                                </div>
                            `);
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching available rooms:', error);
                }
            });
        });


    });
    </script>
</body>

</html>