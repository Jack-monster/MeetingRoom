<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">
<!--<![endif]-->
<!-- Begin Head -->

<head>
    <title>会议室预约系统</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="MobileOptimized" content="320">
    <!--Start Style -->
    <link rel="stylesheet" type="text/css" href="static/css/fonts.css">
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/icofont.min.css">
    <link rel="stylesheet" type="text/css" href="static/css/style.css">
    <link rel="stylesheet" id="theme-change" type="text/css" href="">
</head>

<body>
<div class="loader">
    <div class="spinner">
        <img src="static/picture/loader.gif" alt="">
    </div>
</div>
<!-- Main Body -->
<div class="page-wrapper">

    <div th:replace="header.html::title"></div>

    <!-- Sidebar Start -->
    <aside class="sidebar-wrapper">
        <div class="side-menu-wrap">
            <ul class="main-menu">
                <li>
                    <a href="indexAdmin" >
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                            </span>
                        <span class="menu-text">
                                会议室信息
                        </span>
                    </a>
                </li>

                <li>
                    <a href="manage" class="active">
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-package"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                            </span>
                        <span class="menu-text">
                                预约审批
                        </span>
                    </a>
                </li>
                <li>
                    <a href="users">
                            <span class="icon-menu feather-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-users"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                            </span>
                        <span class="menu-text">
                                用户列表
                            </span>
                    </a>
                </li>

            </ul>
        </div>
    </aside>
    <!-- Container Start -->
    <div class="page-wrapper">
        <div class="main-content">
            <!-- Page Title Start -->
            <div class="row">
                <div class="colxl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="page-title-wrapper">
                        <div class="page-title-box">
                            <h4 class="page-title bold">会议室预约审批</h4>
                        </div>
                        <div class="breadcrumb-list">
                            <ul>
                                <li class="breadcrumb-link">
                                    <a href="javascript:void(0);"><i class="fas fa-home mr-2"></i>会议室预约审批</a>
                                </li>
                                <li class="breadcrumb-link active">会议室预约系统</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Orders Start -->
            <div class="row">
                <!-- Styled Table Card-->
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="card table-card">
                        <div class="card-header pb-0">
                            <h4>会议室预约审批</h4>
                        </div>
                        <div class="card-body">
                            <div class="chart-holder">
                                <div class="table-responsive">
                                    <table class="table table-styled mb-0">
                                        <thead>
                                        <tr>
                                            <th>预约ID</th>
                                            <th>会议室ID</th>
                                            <th>参会人数</th>
                                            <th>预约日期</th>
                                            <th>开始时间</th>
                                            <th>结束时间</th>
                                            <th>预约状态</th>
                                            <th>申请原因</th>
                                            <th>反馈原因</th>
                                            <th>处理</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="reservation, iterStat : ${reservation_list}">
                                            <td th:text="'#'+${reservation.getReservation_id()}">这是预约ID</td>
                                            <td th:text="'#'+${reservation.getRoom_id()}">$600</td>
                                            <td th:text="${reservation.getAttendees()}">$600</td>
                                            <td th:text="${reservation.getReservation_date()}">$600</td>
                                            <td th:text="${reservation.getStart_time()}">$600</td>
                                            <td th:text="${reservation.getEnd_time()}">这是简介</td>
                                            <td>
                                                <label class="mb-0 badge badge-primary" title="" data-original-title="Pending" th:if="${reservation.getStatus().equals('pendding')}">待处理</label>
                                                <label class="mb-0 badge badge-success" title="" data-original-title="Pending" th:if="${reservation.getStatus().equals('approved')}">已批准</label>
                                                <label class="mb-0 badge badge-danger" title="" data-original-title="Pending" th:if="${reservation.getStatus().equals('rejected')}">被驳回</label>
                                            </td>
                                            <td th:text="${reservation.getApply_reason()}">---</td>
                                            <td>
                                                <div th:if="${reservation.getStatus() == 'approved' || reservation.getStatus() == 'rejected'}">
                                                    <span th:text="${reservation.getFeedback_reason()}">---</span>
                                                </div>
                                                <div th:if="${reservation.getStatus() == 'pendding'}">
                                                    <input id="feedback_reason" style="outline: 2px solid blue;" type="text" value="请输入反馈原因" name="feedback_reason"/>
                                                </div>
                                            </td>
                                            <td class="relative">
                                                <button th:classappend="${reservation.getStatus() == 'pendding'} ? '' : 'disabled'"
                                                        class="action-btn dropdown-toggle"
                                                        th:attr="data-toggle=${reservation.getStatus() == 'pendding'} ? 'dropdown' : '',
                                 aria-haspopup=${reservation.getStatus() == 'pendding'} ? 'true' : 'false',
                                 aria-expanded=${reservation.getStatus() == 'pendding'} ? 'false' : 'false'"
                                                        th:disabled="${reservation.getStatus() != 'pendding'}"
                                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <svg class="default-size " viewBox="0 0 341.333 341.333 ">
                                                        <g>
                                                            <g>
                                                                <g>
                                                                    <path d="M170.667,85.333c23.573,0,42.667-19.093,42.667-42.667C213.333,19.093,194.24,0,170.667,0S128,19.093,128,42.667 C128,66.24,147.093,85.333,170.667,85.333z "></path>
                                                                    <path d="M170.667,128C147.093,128,128,147.093,128,170.667s19.093,42.667,42.667,42.667s42.667-19.093,42.667-42.667 S194.24,128,170.667,128z "></path>
                                                                    <path d="M170.667,256C147.093,256,128,275.093,128,298.667c0,23.573,19.093,42.667,42.667,42.667s42.667-19.093,42.667-42.667 C213.333,275.093,194.24,256,170.667,256z "></path>
                                                                </g>
                                                            </g>
                                                        </g>
                                                    </svg>
                                                </button>
                                                <div class="dropdown-menu">
                                                    <a class="dropdown-item" th:value="@{approve(reservationId=${reservation.getReservation_id()})}" onclick="handleAction(this,'approve')">批准</a>
                                                    <a class="dropdown-item" th:value="@{reject(reservationId=${reservation.getReservation_id()})}"  onclick="handleAction(this,'reject')">拒绝</a>
                                                </div>
                                            </td>

                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ad-footer-btm">
                <p>Copyright &copy; 2021.Company name All rights reserved.<a target="_blank" href="https://sc.chinaz.com/moban/">&#x7F51;&#x9875;&#x6A21;&#x677F;</a></p>
            </div>
        </div>
    </div>
</div>

<!-- Script Start -->
<script src="static/js/jquery.min.js"></script>
<script src="static/js/popper.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/swiper.min.js"></script>
<script src="static/js/apexcharts.min.js"></script>
<script src="static/js/control-chart-apexcharts.js"></script>
<!-- Page Specific -->
<script src="static/js/nice-select.min.js"></script>
<!-- Custom Script -->
<script src="static/js/custom.js"></script>
<script>    function handleAction(element, action) {
    // 获取 reservationId 从 th:value 属性中
    var reservationId = element.getAttribute('value').split('=')[1].split('&')[0];

    // 获取输入框的值（假设输入框的 ID 是 feedback_reason）
    var feedbackReason = document.getElementById('feedback_reason').value;

    // 构建新的 URL
    var newUrl = action + '?reservationId=' + reservationId + '&feedback_reason=' + encodeURIComponent(feedbackReason);

    // 跳转到新的 URL
    // window.location.href = newUrl;
    $.ajax({
        url: newUrl,
        method: 'GET',
        success: function (response) {
            if(response.status === "success") {
                window.location.href = 'manage';
                alert(response.message)
            }else{
                window.location.href = 'manage';
                alert(response.message)
            }
        },
        error: function (xhr, status, error) {
            window.location.href = 'manage';
            alert('预约审核失败，请重试。');
            console.error('Error reserving room:', error);
        }
    });

}
</script>
</body>

</html>